/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Jam-Do.com (alex.sova@pm.me). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
var z=Object.defineProperty;var D=(n,t,e)=>t in n?z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var b=(n,t,e)=>(D(n,typeof t!="symbol"?t+"":t,e),e);function O(n){let t=e=>{var s;for(let i in e)((s=e[i])==null?void 0:s.constructor)===Object&&(e[i]=t(e[i]));return{...e}};return t(n)}var a=class{constructor(t){this.uid=Symbol(),this.name=t.name||null,t.schema.constructor===Object?this.store=O(t.schema):(this._storeIsProxy=!0,this.store=t.schema),this.callbackMap=Object.create(null)}static warn(t,e){console.warn(`Symbiote Data: cannot ${t}. Prop name: `+e)}read(t){return!this._storeIsProxy&&!this.store.hasOwnProperty(t)?(a.warn("read",t),null):this.store[t]}has(t){return this._storeIsProxy?this.store[t]!==void 0:this.store.hasOwnProperty(t)}add(t,e,s=!0){!s&&Object.keys(this.store).includes(t)||(this.store[t]=e,this.callbackMap[t]&&this.callbackMap[t].forEach(i=>{i(this.store[t])}))}pub(t,e){if(!this._storeIsProxy&&!this.store.hasOwnProperty(t)){a.warn("publish",t);return}this.add(t,e)}multiPub(t){for(let e in t)this.pub(e,t[e])}notify(t){this.callbackMap[t]&&this.callbackMap[t].forEach(e=>{e(this.store[t])})}sub(t,e,s=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(t)?(a.warn("subscribe",t),null):(this.callbackMap[t]||(this.callbackMap[t]=new Set),this.callbackMap[t].add(e),s&&e(this.store[t]),{remove:()=>{this.callbackMap[t].delete(e),this.callbackMap[t].size||delete this.callbackMap[t]},callback:e})}remove(){delete a.globalStore[this.uid]}static registerLocalCtx(t){let e=new a({schema:t});return a.globalStore[e.uid]=e,e}static registerNamedCtx(t,e){let s=a.globalStore[t];return s?console.warn('State: context name "'+t+'" already in use'):(s=new a({name:t,schema:e}),a.globalStore[t]=s),s}static clearNamedCtx(t){delete a.globalStore[t]}static getNamedCtx(t,e=!0){return a.globalStore[t]||(e&&console.warn('State: wrong context name - "'+t+'"'),null)}};a.globalStore=Object.create(null);var o=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym"});var H="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",V=H.length-1,v=class{static generate(t="XXXXXXXXX-XXX"){let e="";for(let s=0;s<t.length;s++)e+=t[s]==="-"?t[s]:H.charAt(Math.random()*V);return e}};function B(n,t){if(t.shadowRoot)return;let e=[...n.querySelectorAll("slot")];if(t.initChildren.length&&e.length){let s={};e.forEach(i=>{let r=i.getAttribute("name");r?s[r]={slot:i,fr:document.createDocumentFragment()}:s.__default__={slot:i,fr:document.createDocumentFragment()}}),t.initChildren.forEach(i=>{var l;let r=(l=i.getAttribute)==null?void 0:l.call(i,"slot");r?(i.removeAttribute("slot"),s[r].fr.appendChild(i)):s.__default__&&s.__default__.fr.appendChild(i)}),Object.values(s).forEach(i=>{i.slot.parentNode.insertBefore(i.fr,i.slot),i.slot.remove()})}}function $(n,t){[...n.querySelectorAll(`[${o.EL_REF_ATTR}]`)].forEach(e=>{let s=e.getAttribute(o.EL_REF_ATTR);t.ref[s]=e,e.removeAttribute(o.EL_REF_ATTR)})}function U(n,t){[...n.querySelectorAll(`[${o.BIND_ATTR}]`)].forEach(e=>{e.getAttribute(o.BIND_ATTR).split(";").forEach(r=>{if(!r)return;let l=r.split(":").map(g=>g.trim()),h=l[0],w;h.indexOf(o.ATTR_BIND_PRFX)===0&&(w=!0,h=h.replace(o.ATTR_BIND_PRFX,""));let u=l[1].split(",").map(g=>g.trim()),x,d,p,c;if(h.includes(".")){x=!0;let g=h.split(".");c=()=>{d=e,g.forEach((_,N)=>{N<g.length-1?d=d[_]:p=_})},c()}for(let g of u)t.sub(g,_=>{w?(_==null?void 0:_.constructor)===Boolean?_?e.setAttribute(h,""):e.removeAttribute(h):e.setAttribute(h,_):x?d?d[p]=_:window.setTimeout(()=>{c(),d[p]=_}):e[h]=_})}),e.removeAttribute(o.BIND_ATTR)})}var S="{{",T="}}",j="skip-text";function W(n){let t,e=[],s=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:i=>{var r;return!((r=i.parentElement)!=null&&r.hasAttribute(j))&&i.textContent.includes(S)&&i.textContent.includes(T)&&1}});for(;t=s.nextNode();)e.push(t);return e}var Y=function(n,t){W(n).forEach(s=>{let i=[],r;for(;s.textContent.includes(T);)s.textContent.startsWith(S)?(r=s.textContent.indexOf(T)+T.length,s.splitText(r),i.push(s)):(r=s.textContent.indexOf(S),s.splitText(r)),s=s.nextSibling;i.forEach(l=>{let h=l.textContent.replace(S,"").replace(T,"");t.sub(h,w=>{l.textContent=w})})})},L=[B,$,U,Y];var R=0,C=class extends HTMLElement{initCallback(){}__initCallback(){var t;this.__initialized||(this.__initialized=!0,(t=this.initCallback)==null||t.call(this))}render(t,e=this.renderShadow){let s;if((e||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(t||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(t==null?void 0:t.constructor)===DocumentFragment)s=t;else if((t==null?void 0:t.constructor)===String){let r=document.createElement("template");r.innerHTML=t,s=r.content.cloneNode(!0)}else this.constructor.__tpl&&(s=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(s,this)}let i=()=>{s&&(e&&this.shadowRoot.appendChild(s)||this.appendChild(s)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){e=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=i,this.shadowRoot.prepend(r)}else i()}addTemplateProcessor(t){this.tplProcessors.add(t)}constructor(){super();this.init$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=v.generate(),this.style.setProperty(o.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(o.CSS_CTX_PROP,!0)}get ctxName(){var t;return((t=this.getAttribute(o.CTX_NAME_ATTR))==null?void 0:t.trim())||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=a.registerLocalCtx({})),this.__localCtx}get nodeCtx(){return a.getNamedCtx(this.ctxName,!1)||a.registerNamedCtx(this.ctxName,{})}static __parseProp(t,e){let s,i;if(t.startsWith(o.EXT_DATA_CTX_PRFX))s=e.nodeCtx,i=t.replace(o.EXT_DATA_CTX_PRFX,"");else if(t.includes(o.NAMED_DATA_CTX_SPLTR)){let r=t.split(o.NAMED_DATA_CTX_SPLTR);s=a.getNamedCtx(r[0]),i=r[1]}else s=e.localCtx,i=t;return{ctx:s,name:i}}sub(t,e){let s=C.__parseProp(t,this);this.allSubs.add(s.ctx.sub(s.name,e))}notify(t){let e=C.__parseProp(t,this);e.ctx.notify(e.name)}has(t){let e=C.__parseProp(t,this);return e.ctx.has(e.name)}add(t,e){let s=C.__parseProp(t,this);s.ctx.add(s.name,e,!1)}add$(t){for(let e in t)this.add(e,t[e])}get $(){if(!this.__stateProxy){let t=Object.create(null);this.__stateProxy=new Proxy(t,{set:(e,s,i)=>{let r=C.__parseProp(s,this);return r.ctx.pub(r.name,i),!0},get:(e,s)=>{let i=C.__parseProp(s,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(t){for(let e in t)this.$[e]=t[e]}__initDataCtx(){let t=this.constructor.__attrDesc;if(t)for(let e of Object.values(t))Object.keys(this.init$).includes(e)||(this.init$[e]="");for(let e in this.init$)if(e.startsWith(o.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(o.EXT_DATA_CTX_PRFX,""),this.init$[e]);else if(e.includes(o.NAMED_DATA_CTX_SPLTR)){let s=e.split(o.NAMED_DATA_CTX_SPLTR),i=s[0].trim(),r=s[1].trim();if(i&&r){let l=a.getNamedCtx(i,!1);l||(l=a.registerNamedCtx(i,{})),l.add(r,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var t;if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let e=(t=this.getAttribute(o.CTX_NAME_ATTR))==null?void 0:t.trim();e&&this.style.setProperty(o.CSS_CTX_PROP,`'${e}'`),this.__initDataCtx(),this.initChildren=[...this.childNodes];for(let s of L)this.addTemplateProcessor(s);this.pauseRender?this.__initCallback():this.render()}this.connectedOnce=!0}destroyCallback(){}disconnectedCallback(){this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let t of this.allSubs)t.remove(),this.allSubs.delete(t);for(let t of this.tplProcessors)this.tplProcessors.delete(t)},100))}static reg(t,e=!1){if(t||(R++,t=`${o.AUTO_TAG_PRFX}-${R}`),this.__tag=t,window.customElements.get(t)){console.warn(`${t} - is already in "customElements" registry`);return}window.customElements.define(t,e?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(t){this.observedAttributes=Object.keys(t),this.__attrDesc=t}attributeChangedCallback(t,e,s){if(e===s)return;let i=this.constructor.__attrDesc[t];i?this.__dataCtxInitialized?this.$[i]=s:this.init$[i]=s:this[t]=s}getCssData(t,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(t)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let s=this.__computedStyle.getPropertyValue(t).trim();s.startsWith("'")&&s.endsWith("'")&&(s=s.replace(/\'/g,'"'));try{this.__cssDataCache[t]=JSON.parse(s)}catch{!e&&console.warn(`CSS Data error: ${t}`),this.__cssDataCache[t]=null}}return this.__cssDataCache[t]}bindCssData(t,e=!0){let s=(e?o.EXT_DATA_CTX_PRFX:"")+t;return this.add(s,this.getCssData(t,!0)),s}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(t,e,s){let i="__"+t;this[i]=this[t],Object.defineProperty(this,t,{set:r=>{this[i]=r,s?window.setTimeout(()=>{e==null||e(r)}):e==null||e(r)},get:()=>this[i]}),this[t]=this[i]}static set shadowStyles(t){let e=new Blob([t],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(e)}},y=C;b(y,"template");var E=class{constructor(){this.cach=[]}read(t,e,s=[],i){let r=e.length,l=s.length;t.length=r,t.fill(null,0,r);let h=l?20/r:0,w=l?80/r:100/r,u=0,x=0;s.forEach((d,p)=>{let c=new Image;c.src=d,this.cach.push(c),c.onload=()=>{t[p]||t.splice(p,1,c),u<100?u+=h:u=100,i&&i(u)}}),e.forEach((d,p)=>{let c=new Image;c.src=d,this.cach.push(c),c.onload=()=>{t.splice(p,1,c),x++,u<100&&(u+=w),x===r&&(u=100),i&&i(Math.floor(u))}})}kill(){this.cach.length&&this.cach.forEach(t=>{t.src="",t=null}),this.cach=[]}};var F=`<style> :host { position: relative; display: flex; justify-content: center; align-items: center; height: 100%; max-height: 100vh; width: 100%; max-width: 100vw; background-repeat: no-repeat; background-position: center center; background-size: contain; user-select: none; overflow: hidden; } .start-btn { position: absolute; height: 60px; width: 60px; box-sizing: border-box; top: 50%; left: 50%; margin-left: -30px; margin-top: -30px; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.2s; box-shadow: 0 0 var(--gap-mid) rgba(0, 0, 0, 0.2); } .start-btn:hover { transform: scale(1.2); } :host([active]) .start-btn { opacity: 0; visibility: hidden; pointer-events: none; } :host(:not([active])) .active { opacity: 0; pointer-events: none; } #canvas-el { box-sizing: border-box; transition: 0.1s; height: 100%; width: 100%; object-fit: contain; } .sensor { position: absolute; top: 0; left: 0; right: 0; bottom: 44px; box-sizing: border-box; } </style><canvas ref="canvas-el"></canvas><div class="sensor" ref="sensor-el"></div><div class="start-btn" ref="play-btn"><logo-com compact></logo-com></div><hmp-toolbar-el><hmp-button-el icon="play" ref="play-status-btn"></hmp-button-el><hmp-button-el class="active" icon="plus" ref="zoom-in-btn"></hmp-button-el><hmp-button-el class="active" icon="minus" ref="zoom-out-btn"></hmp-button-el><hmp-button-el class="active" icon="stop" ref="unload-btn"></hmp-button-el></hmp-toolbar-el><hmp-progress-bar-el ref="progress-bar"></hmp-progress-bar-el><hmp-info-bar-el ref="info-bar"></hmp-info-bar-el>`;var M=class{constructor(){this.fullscreen=!1,this.infoActive=!1,this.shareActive=!1}},k=class{constructor(t){this.uid=v.generate(),this.hmpElement=t.hmpElement,this.schema=new M,this.callbackMap=Object.create(null)}read(t){return this.schema[t]}pub(t,e){this.schema[t]=e,this.callbackMap[t].forEach(s=>{s(this.schema[t])})}sub(t,e){this.callbackMap[t]||(this.callbackMap[t]=[]),this.callbackMap[t].push(e)}remove(){delete m[this.uid]}},m=class{static get key(){return"__HMP_STATE__"}static register(t){let e=new k({hmpElement:t});return m.store[e.uid]=e,e}static findStateFor(t){let e=t;for(;e&&!e[this.key];)e=e.parentNode||e.parentElement||e.host;return e[this.key]}};m.store=Object.create(null);var A=class{static _getSupported(t){return t.find(e=>!!document[e]||!!document.createElement("div")[e])}static get _fsRequestName(){let t=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"];return this._getSupported(t)}static get _fsExitName(){let t=["exitFullscreen","webkitExitFullscreen","msExitFullscreen","mozCancelFullScreen"];return this._getSupported(t)}static enable(t){t[this._fsRequestName]()}static disable(){document[this._fsExitName]()}static get current(){return document[this._fsIsName]}static init(){this._initialized||(this._fsRequestName.includes("webkit")?(this._fsCallbackName="onwebkitfullscreenchange",this._fsIsName="webkitIsFullScreen"):this._fsRequestName.includes("moz")?(this._fsCallbackName="onmozfullscreenchange",this._fsIsName="mozFullScreen"):this._fsRequestName.includes("ms")?(this._fsCallbackName="MSFullscreenChange",this._fsIsName="webkitIsFullScreen"):(this._fsCallbackName="onfullscreenchange",this._fsIsName="fullscreen"),this._initialized=!0)}};var I="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z",f=class extends y{constructor(){super(...arguments);b(this,"renderShadow",!0);b(this,"init$",{path:I})}initCallback(){this.sub("icon",t=>{this.$.path=f.iconSet[t]||I})}static addIcons(t){Object.assign(f.iconSet,t)}};f.iconSet=Object.create(null);f.template=`<style> :host { --size: 1.2em; display: inline-flex; height: var(--size); width: var(--size); min-width: var(--size); } svg { height: 100%; width: 100%; } :host[morph] path { transition: var(--transition, 0.2s); } </style><svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path set="@d: path" style="fill: currentColor"></path></svg>`;f.bindAttributes({icon:"icon"});f.reg("ims-icon");var X={play:"M8,5.14V19.14L19,12.14L8,5.14Z",pause:"M14,19H18V5H14M6,19H10V5H6V19Z",stop:"M18,18H6V6H18V18Z",plus:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",minus:"M19,13H5V11H19V13Z",info:"M13.5,4A1.5,1.5 0 0,0 12,5.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 15,5.5A1.5,1.5 0 0,0 13.5,4M13.14,8.77C11.95,8.87 8.7,11.46 8.7,11.46C8.5,11.61 8.56,11.6 8.72,11.88C8.88,12.15 8.86,12.17 9.05,12.04C9.25,11.91 9.58,11.7 10.13,11.36C12.25,10 10.47,13.14 9.56,18.43C9.2,21.05 11.56,19.7 12.17,19.3C12.77,18.91 14.38,17.8 14.54,17.69C14.76,17.54 14.6,17.42 14.43,17.17C14.31,17 14.19,17.12 14.19,17.12C13.54,17.55 12.35,18.45 12.19,17.88C12,17.31 13.22,13.4 13.89,10.71C14,10.07 14.3,8.67 13.14,8.77Z",share:"M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z",fullscreen:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z","fullscreen-exit":"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z","chevron-up":"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z",facebook:"M17,2V2H17V6H15C14.31,6 14,6.81 14,7.5V10H14L17,10V14H14V22H10V14H7V10H10V6A4,4 0 0,1 14,2H17Z",twitter:"M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z",telegram:"M9.78,18.65L10.06,14.42L17.74,7.5C18.08,7.19 17.67,7.04 17.22,7.31L7.74,13.3L3.64,12C2.76,11.75 2.75,11.14 3.84,10.7L19.81,4.54C20.54,4.21 21.24,4.72 20.96,5.84L18.24,18.65C18.05,19.56 17.5,19.78 16.74,19.36L12.6,16.3L10.61,18.23C10.38,18.46 10.19,18.65 9.78,18.65Z"};A.init();f.addIcons(X);var P=class extends y{constructor(){super();b(this,"renderShadow",!0);b(this,"init$",{data:""});this[m.key]=m.register(this),this[m.key].sub("fullscreen",t=>{t?A.enable(this):A.disable()}),this.parent=null,this._imgArray=[],this._imageReader=new E,this._isEdge=navigator.appVersion.indexOf("Edge")!==-1}get cfg(){return this.config}_setConfig(t){if(!t){console.log(t);return}this.config||(this.config=t),this._imgHeight=t.imgHeight||480,this._imgWidth=t.imgWidth||640,this._imageProportion=this._imgWidth/this._imgHeight,this.style.backgroundColor=t.theme.bgColor,this.ref["info-bar"].style.backgroundColor=t.theme.bgColor,this.style.setProperty("--color",t.theme.color),this.style.setProperty("--bg-color",t.theme.bgColor),this.ref["info-bar"].style.color=t.theme.color,this.ref["info-bar"].innerHTML=`<span slot="name">${t.title||"Unnamed"}</span><span slot="description">${t.description||"No description..."}</span>`.trim(),this.ref["canvas-el"].height=this._imgHeight,this.ref["canvas-el"].width=this._imgWidth,this.ref["canvas-el"].style.maxHeight=this._imgHeight+"px",this.ref["canvas-el"].style.maxWidth=this._imgWidth+"px",this._ctx2d=this.ref["canvas-el"].getContext("2d"),this.currentFrame=t.startFrame&&t.startFrame-1||0,this._directionStep=t.invertDirection?-1:1,t.showPlaceholder?this._showPreview():(this._loadContents(t),this.setAttribute("active",""))}set _loadProgress(t){this._progressBar.progress=t}_loadContents(t){if(this._imgLoadingInitialized&&!this.preview)return;window.localStorage.setItem("HMP_CURRENT_PLAY",this._localUid),window.dispatchEvent(new CustomEvent("hmp-current-play",{detail:{uid:this._localUid}})),this._imgLoadingInitialized=!0,this._drawPreviewImage();let e=s=>{this._loadProgress=s,s===100&&(t.autoplay?this._play():this.currentFrame=this._currentFrame+1)};this._imageReader.kill(),this._imageReader.read(this._imgArray,t.src,t.srcPreviews,e),this.preview=!1}set currentFrame(t){if(t===this._currentFrame)return;this._currentFrame=t;let e=this._imgArray[t];e?(this._ctx2d.filter="none",this.removeAttribute("loading"),this._ctx2d.drawImage(e,0,0,this._imgWidth,this._imgHeight),this._lastLoadedFrame=e):(this.setAttribute("loading",""),this._lastLoadedFrame&&(this._ctx2d.filter="blur(10px)",this._ctx2d.drawImage(this._lastLoadedFrame,0,0,this._imgWidth,this._imgHeight)))}get currentFrame(){return this._currentFrame}_drawPreviewImage(){var s,i,r,l;let t=((s=this.cfg)==null?void 0:s.placeholderUrl)||((r=this.cfg)==null?void 0:r.src[(i=this.cfg)==null?void 0:i.startFrame])||((l=this.cfg)==null?void 0:l.src[0]);if(!t)return;let e=document.createElement("img");e.src=t,e.onload=()=>{this._ctx2d.drawImage(e,0,0,this._imgWidth,this._imgHeight)}}_showPreview(){this.preview=!0,this._zoomOut(),this.kill(),this._progressBar&&(this._loadProgress=0),this.removeAttribute("active"),this._drawPreviewImage()}set _playStatusFlag(t){this._psFlagLoc!==t&&(this._psFlagLoc=t,t?(this._playStatusBtn.setAttribute("icon","pause"),this.setAttribute("active","")):this._playStatusBtn.setAttribute("icon","play"))}get _playStatusFlag(){return this._psFlagLoc}_play(){this._playStatusFlag=!0,this.preview&&this._loadContents(this.cfg),this._playInterval&&window.clearInterval(this._playInterval),this._playInterval=window.setInterval(()=>{this.currentFrame<this._imgArray.length-1&&this.currentFrame>0?this.currentFrame=this.currentFrame+this._directionStep:this.currentFrame===0?this.currentFrame=this._directionStep<0?this._imgArray.length-1:this.currentFrame+1:this.currentFrame===this._imgArray.length-1&&(this.currentFrame=this._directionStep<0?this.currentFrame-1:0)},this.cfg.speed)}_togglePlay(t){t&&t.preventDefault(),this._playStatusFlag?this._pause():this._play()}_pause(){this._playStatusFlag=!1,clearInterval(this._playInterval)}_setCanvasTransforms(){window.requestAnimationFrame(()=>{this.ref["canvas-el"].style.transform=`scale(${this._zoomLevel}) translate(${this._panX}px, ${this._panY}px)`})}_zoomStepIn(){this._zoomLevel||(this._zoomLevel=1),this._zoomLevel+=.2,this._panX=0,this._panY=0,this._rect||(this._rect=this.getBoundingClientRect()),this._setCanvasTransforms(),this._zoomPanHandler||(this._zoomPanHandler=t=>{this._panX=Math.round((this._rect.left+this._rect.width/2-t.clientX)/(10/this._zoomLevel)),this._panY=Math.round((this._rect.top+this._rect.height/2-t.clientY)/(10/this._zoomLevel)),this._setCanvasTransforms()}),this.addEventListener("mousemove",this._zoomPanHandler)}_zoomOut(){this._zoomLevel=1,this._panX=0,this._panY=0,this.ref["canvas-el"].style.transform="none",this.removeEventListener("mousemove",this._zoomPanHandler)}initCallback(){this.sub("data",t=>{!t||window.fetch(t).then(e=>{e.text().then(s=>{this._setConfig(JSON.parse(s))})})}),this._onResize=()=>{!this._isEdge||(this._rect=this.getBoundingClientRect(),this._rect.width&&this._rect.height?(this._rectProportion=this._rect.width/this._rect.height,this._rectProportion>this._imageProportion?(this.ref["canvas-el"].style.height=this._rect.height+"px",this.ref["canvas-el"].style.width="auto"):(this.ref["canvas-el"].style.width=this._rect.width+"px",this.ref["canvas-el"].style.height="auto")):(this.ref["canvas-el"].style.height="100%",this.ref["canvas-el"].style.width="auto"))},this._localUid=v.generate(),this.defineAccessor("config",t=>{this._setConfig(t)}),this.ref["play-btn"].onclick=()=>{this._loadContents(this.cfg),this.setAttribute("active","")},this._progressBar=this.ref["progress-bar"],this._playStatusBtn=this.ref["play-status-btn"],this._playStatusBtn.onclick=()=>{this._togglePlay()},this._zoomInBtn=this.ref["zoom-in-btn"],this._zoomOutBtn=this.ref["zoom-out-btn"],this._zoomInBtn.onclick=()=>{this._zoomStepIn()},this._zoomOutBtn.onclick=()=>{this._zoomOut()},this._unloadBtn=this.ref["unload-btn"],this._unloadBtn.onclick=()=>{this._showPreview(),this._playStatusFlag=!1},this.infoBar=this.ref["info-bar"],this._moveHandler=t=>{t.touches&&(t.preventDefault(),t.movementX=t.touches[0].clientX-(this._touchStartX||t.touches[0].clientX),t.movementY=t.touches[0].clientY-(this._touchStartY||t.touches[0].clientY),this._touchStartX=t.touches[0].clientX,this._touchStartY=t.touches[0].clientY),this._collectedMovement+=t.movementX},this._moveEndHandler=t=>{window.onmousemove=null,window.onmouseup=null,window.removeEventListener("touchmove",this._moveHandler),window.removeEventListener("touchend",this._moveEndHandler),window.removeEventListener("touchcancel",this._moveEndHandler),this._moveInProgress=!1,this._collectedMovement=(this._collectedMovement+this._lastCollectedMovement)/2,this._innertionK=.92},this._moveStartHandler=t=>{if(this.preview)return;this._pause(),this._moveInProgress=!0,t.touches&&(this._touchStartX=t.touches[0].clientX,this._touchStartY=t.touches[0].clientY),this._moveFrame=this.currentFrame;let e=this.getBoundingClientRect();this._componentWidth=e.width,window.onmousemove=this._moveHandler,window.onmouseup=this._moveEndHandler,window.addEventListener("touchmove",this._moveHandler,{passive:!1}),window.addEventListener("touchend",this._moveEndHandler),window.addEventListener("touchcancel",this._moveEndHandler),this._collectedMovement=0,this._intervalInit()},this._intervalInit=()=>{this._moveInterval=setInterval(()=>{let t=this._componentWidth/(this._componentWidth/500),e=this._collectedMovement/t,s=Math.round((this._imgArray.length-1)*e),i=this._directionStep>0?this.currentFrame+s:this.currentFrame-s;i>this._imgArray.length-1&&(i=Math.abs(i-(this._imgArray.length-1))),i<0&&(i=this._imgArray.length-1-Math.abs(i)),this.currentFrame=i>-1&&i<this._imgArray.length?i:0,this._moveInProgress?(this._lastCollectedMovement=this._collectedMovement,this._collectedMovement=0):Math.abs(this._collectedMovement)<.6?clearInterval(this._moveInterval):this._collectedMovement=this._collectedMovement*this._innertionK},this.cfg.speed/2)},this.ref["sensor-el"].onmousedown=this._moveStartHandler,this.ref["sensor-el"].addEventListener("touchstart",this._moveStartHandler),window.onkeyup=t=>{t.keyCode===32&&(this._togglePlay(t),this.setAttribute("active",""))},window.addEventListener("storage",t=>{t.key==="HMP_CURRENT_PLAY"&&window.localStorage.getItem("HMP_CURRENT_PLAY")!==this._localUid&&(this._showPreview(),this._playStatusFlag=!1)}),window.addEventListener("hmp-current-play",t=>{t.detail.uid!==this._localUid&&(this._showPreview(),this._playStatusFlag=!1)}),window.addEventListener("resize",this._onResize),window.addEventListener("fullscreen-changed",()=>{window.setTimeout(()=>{this._onResize()},220)}),this._onResize()}kill(){this._imgLoadingInitialized=!1,this._imageReader.kill(),this._playInterval&&window.clearInterval(this._playInterval),this._imgArray.forEach(t=>{t&&(t.src=""),t=null}),this._imgArray=[]}destroyCallback(){this.kill(),this[m.key].remove()}};P.bindAttributes({data:"data"});P.template=F;P.reg("ims-photo-spinner");export{P as PhotoSpinner};